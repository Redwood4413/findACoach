import h from"./NotFound-318e5610.js";import{e as g,f as c,u as _,L as y,M as R,a as C,o as n,c as I,b as u,w as d,g as i,h as E,t as k,i as B,T as N,S as A,U as F,p as M,k as D,d as b}from"./index-42d548a4.js";import{_ as m}from"./CoachAddReviewForm-4317bef4.js";import{_ as p}from"./CoachWrapperHeader-e71b663c.js";import{s as x}from"./sendingMachine-1e298bbc.js";import"./CoachAvatar-5a218491.js";const T={name:"CoachEditReview",props:{id:{type:String,required:!0},reviewId:{type:String,required:!0}},data:()=>({errorMsg:""}),setup(){const t=g(),a=c(),s=_(),{state:e,send:o}=y(x);return{coachesStore:t,authStore:a,reviewsStore:s,state:e,send:o}},methods:{async sendData({description:t,rate:a}){this.send("SEND");const s={description:t,rate:a,editedAt:Date.now()};try{const{error:e}=await R.from("reviews").update(s).eq("reviewId",this.reviewId);if(e)throw new Error(e.message);this.send("SUCCESS"),await this.reviewsStore.reloadReviews(),setTimeout(()=>{var o;this.$route.name==="edit-review"&&this.$router.replace({name:"reviews",hash:`#${(o=this.review)==null?void 0:o.reviewId}`})},this.state.context.timing)}catch(e){this.errorMsg=e,this.send("ERROR")}}},computed:{coach(){return this.coachesStore.getCoach(this.id)},isFound(){return!!this.coach},review(){return this.reviewsStore.getReviewById(this.reviewId)}},async beforeRouteEnter(t,a,s){const e=_(),o=c();await e.fetchReviews(t.params.id);const r=e.getReviewById(t.params.reviewId);if(!r){s({name:"not-found"});return}if(r.authorId!==o.userId){s({name:"no-permissions"});return}s()},components:{CoachWrapperHeader:p,NotFound:h,CoachAddReviewForm:m}};const V=t=>(M("data-v-de6402dd"),t=t(),D(),t),q={key:0,class:"edit-review"},H=V(()=>b("h3",null,"Your review has been edited.",-1));function U(t,a,s,e,o,r){const w=p,v=m,l=A,S=F,f=h;return r.isFound?(n(),I("div",q,[u(w,{id:s.id},null,8,["id"]),u(N,{mode:"out-in"},{default:d(()=>[e.state.matches("empty")?(n(),i(v,{key:0,review:r.review,onAddReview:r.sendData,state:e.state.value},null,8,["review","onAddReview","state"])):e.state.matches("sent")?(n(),i(l,{key:1},{default:d(()=>[H]),_:1})):e.state.matches("error")?(n(),i(S,{key:2},{default:d(()=>[E(k(t.errorMsg),1)]),_:1})):B("",!0)]),_:1})])):(n(),i(f,{key:1,element:"Coach"}))}const G=C(T,[["render",U],["__scopeId","data-v-de6402dd"]]);export{G as default};
